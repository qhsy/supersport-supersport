<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>十全十美 GODO达人大比拼</title>
<meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
<style type="text/css">
html{font-size: 100px; font-family: 'microsoft yahei', Verdana, Arial, Helvetica, sans-serif;}
body,div,dl,dt,dd,ul,ol,li,h1,h2,h3,h4,pre,form,fieldset,input,textarea,blockquote,p,button,header,footer,nav,section,article,aside,video,audio,figure,figcaption,hgroup{padding: 0px; margin: 0px; tap-highlight-color: rgba(0, 0, 0, 0); -webkit-tap-highlight-color: rgba(0, 0, 0, 0); -ms-tap-highlight-color: rgba(0, 0, 0, 0); font-size: 0.14rem; line-height: 0.22rem;}
table,td,tr,th{font-size: 0.12rem;}
table{margin: 0 auto;}
img{vertical-align: top; border: 0;}
ol,ul{list-style: none;}
li{list-style-type: none;}
h1,h2,h3,h4,h5,h6{font-weight:normal; font-size: 100%;}
img{width: 100%; height: auto; vertical-align: top; }
address,caption,cite,code,dfn,em,i,b{font-weight: normal; font-style: normal;}
input,textarea,select,button{outline: none; resize: none; border: 0;}
a{-webkit-appearance: none; outline: none; -webkit-tap-highlight-color: rgba(0, 0, 0, 0); -webkit-touch-callout: none; text-decoration: none;}
a:hover {text-decoration: none; }
.f12{font-size: 0.12rem;}.f14{font-size: 0.14rem;}.f16{font-size: 0.16rem;}.f18{font-size: 0.18rem;}
.tl{text-align: left;}.tr{text-align: right;}.tc{text-align: center;}
.fl{float: left;}.fr{float: right;}
.pos-r{position: relative;}.pos-f{position: fixed;}
.ms-controller{visibility: hidden;}

/*container*/
.container{padding-bottom: 0.2rem; background: #ffa21e url(css/img/container.png) repeat-y left top; background-size: cover;}
.person-hd{position: relative; box-shadow: 0 0.03rem 0.3rem rgba(139,69,16, 0.5);}
.person-hd h1{width: 100%; position: absolute; top: 0.1rem; font-size: 0.24rem; color: #fff; text-align: center; line-height: 0.3rem; font-style: italic; }

.person-title{padding: 0 0.2rem; font-size: 0.14rem; font-weight: 700; color: #fff; line-height: 0.3rem;}
.person-title:after{content: ""; width: 0.04rem; height: 0.12rem; margin: 0.09rem 0.09rem 0 0; display: block; float: left; background: #fff; border-radius: 0.1rem;}

.person-value{padding-bottom: 0.12rem; transform: translate3d(0,-0.4rem,0); -webkit-transform: translate3d(0,-0.4rem,0);}
.person-thermal{width: 0.8rem; height: 1.26rem; margin: auto; padding-top: 0.58rem; display: block; -webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; background: url(css/img/thermal.png) no-repeat center center; background-size: 0.8rem; color: #fff; line-height: 0.18rem; text-align: center;}
.person-thermal em{display: block; font-size: 0.14rem; font-weight: 700;}
.person-thermal i{display: block; font-size: 0.13rem; font-weight: 700;}
.person-value h1{font-size: 0.36rem; line-height: 0.4rem; color: #fff; text-align: center;}

.person-experience{padding-bottom: 0.14rem;}
.person-experience p{padding: 0 0.33rem 0.18rem; color: #fff; font-size: 0.14rem; line-height: 0.26rem;}
.person-experience p:nth-of-type(1){padding-top: 0.1rem;}

.photo-list{margin-top: 0.12rem; padding: 0 0.23rem; display: -webkit-flex; display: -moz-flex; display: flex; -webkit-flex-wrap: wrap; flex-wrap: wrap;}
.photo-list li{width: 50%; padding: 0 0.1rem 0.2rem; box-sizing: border-box; -webkit-box-sizing: border-box; -moz-box-sizing: border-box;}
.photo-list li img{border-radius: 0.05rem; box-shadow: 0 0.06rem 0.16rem rgba(139,69,16,0.4);}

.person-top{padding-top: 0.32rem;}
.person-top-list{margin: 0 0.33rem; color: #fff;}
.person-top-list li{height: 0.6rem; overflow: hidden; border-bottom: 1px solid rgba(255,255,255,0.5); line-height: 0.6rem; text-align: right;}
.person-top-list li em{float: left; overflow: hidden; text-align: left;}
.person-top-list span{width: 0.4rem; height: 0.4rem; float: left; margin: 0.1rem 0.1rem 0 0; display: block; border-radius: 50%; overflow: hidden;}
.person-top-list i{width: 0.3rem; float: left; color: #fff; text-align: left;}
.person-btn{height: 0.54rem; display: block; margin: 0.7rem 0.2rem 0; overflow: auto; box-shadow: 0 0.05rem 0.25rem rgba(139,69,16,0.3); background: #fff; border-radius: 0.25rem;}
.person-btn span{display: block; margin: 0.05rem 0 0; color: #de6b1f; text-align: center; font-size: 0.18rem;}
.person-btn em{display: block; text-align: center; color: #e89762; font-size: 0.12rem;}

.touch-main{width: 100%; height: 100%; position: fixed; left: 0; top: 0; background: rgba(0,0,0,0.8); display: none;}
.touch-main ul{height: 100%;}
.touch-main li{height: 100%; position: absolute; display: -webkit-box; -webkit-box-pack: center; -webkit-box-align: center;}
</style>
</head>
<body>
<section class="container" style="visibility: hidden;">
	<header class="person-hd">
		<h1>angelababy</h1>
		<img src="" alt="">
	</header>
	<article class="person-value">
		<span class="person-thermal"><em>热力值</em><i></i></span>	
		<h1></h1>
	</article>
	<article class="person-experience">
		<h1 class="person-title">运动经历</h1>
	</article>
	<article class="person-photo"></article>
	<footer class="person-top" style="display: none;"></footer>
	<a href="javascript:;" class="person-btn">
		<span>去支持TA</span>
		<em></em>
	</a>
</section>
<section class="touch-main" id="touch-main"></section>
<!-- 相册 -->
<script id="thumb" type="text/html">
	<h1 class="person-title">相册</h1>
		<ul class="photo-list">
		{{each userAlbum}}
			<li><img src=" {{$value.iconUrl}} " alt=""></li>
			
		{{/each}}
		</ul>
</script>
<!-- 排行榜 -->
<script id="top" type="text/html">
	<h1 class="person-title">支持TA的人（TOP50）</h1>
	<ul class="person-top-list">
	{{each userDonateInfos}}
		<li><i>1</i><span><img src="image/demo_6.jpg" alt=""></span><em>小王</em>已支持 600000 能量值</li>
	{{/each}}
	</ul>
</script>
<script type="text/javascript" src="script/zepto.min.js"></script>
<script type="text/javascript" src="script/template.js"></script>
<script type="text/javascript">
	$(function(){
		//所有的数据
		var photoList;
		$.ajax({
			url:'/api/userPowerController/userExpertDetail',
			type:'POST',
			contentType: 'application/json',
			dataType: 'json',
			async:false,
			data: '{"pagination": 1,"userCode": "' + urlFormat('code') + '","zoo": {"key": "tesetkey","token": "' + urlFormat('token') + '"}}',
			success: function(data) {
				$('.person-hd h1').text(data.userInfoExpert.realName);
				$('.person-hd img').attr('src',data.userInfoExpert.advPic);
				$('.person-value h1').text(data.userInfoExpert.powerStr);
				$('.person-thermal i').text('No.' + data.userInfoExpert.sort);
				$('.person-experience').append('<p>' + data.userInfoExpert.experience + '</p>');
				if(data.userAlbum.length){
					photoList = data.userAlbum;
					var thumbHtml = template('thumb', data);
					$('.person-photo').html(thumbHtml);
					new Slider({
						dom : document.getElementById('touch-main'),
						list : data.userAlbum
					});
				}
				if(data.userDonateInfos.length){
					var topbHtml = template('top', data);
					$('.person-top').html(topbHtml);
					$('.person-top').css('display','block');
				}
				$('.person-btn em').text('已支持' + data.supportPower + '热力值');
				$('.container').removeAttr('style');
				
			},
			error: function(xhr, status, error) {
				alert(error);
			}
		})
		$('.photo-list').on('tap',function(){
			var children = $('.touch-main').children();
			if(!children.length){
				new Slider({
					dom : document.getElementById('touch-main'),
					list : photoList
				});
			}
			$('.touch-main').css('display','block');
			
		});
		$('.person-btn').on('tap',function(){
			window.location.href = 'index/index.html?token=' + urlFormat('token');
		});
	});
	//构造函数
	function Slider(opts){
		//构造函数需要的参数
		this.wrap = opts.dom;
		this.list = opts.list;
		//构造三步奏
		this.init();
		this.renderDOM();
		this.bindDOM();
	}

	//第一步 -- 初始化
	Slider.prototype.init = function() {
		//设定窗口比率
		this.radio = window.innerHeight/window.innerWidth;
		//设定一页的宽度
		this.scaleW = window.innerWidth;
		//设定初始的索引值
		this.idx = 0;
	};

	//第二步 -- 根据数据渲染DOM
	Slider.prototype.renderDOM = function(){
		var wrap = this.wrap;
		var data = this.list;
		var len = data.length;

		this.outer = document.createElement('ul');
		//根据元素的
		for(var i = 0; i < len; i++){
			var li = document.createElement('li');
			var item = data[i];
			li.style.width = window.innerWidth +'px';
			li.style.webkitTransform = 'translate3d('+ i*this.scaleW +'px, 0, 0)';
			if(item){
				//根据窗口的比例与图片的比例来确定
				//图片是根据宽度来等比缩放还是根据高度来等比缩放
				if(item['height']/item['width'] > this.radio){
					li.innerHTML = '<img height="'+ window.innerHeight +'" src="'+ item['picture'] +'">';
				}else{
					li.innerHTML = '<img width="'+ window.innerWidth +'" src="'+ item['picture'] +'">';
				}
			}
			this.outer.appendChild(li);
		}

		//UL的宽度和画布宽度一致
		this.outer.style.cssText = 'width:' + this.scaleW +'px';

		wrap.style.height = window.innerHeight + 'px';
		wrap.appendChild(this.outer);
	};

	Slider.prototype.goIndex = function(n){
		var idx = this.idx;
		var lis = this.outer.getElementsByTagName('li');
		var len = lis.length;
		var cidx;
		//如果传数字 2,3 之类可以使得直接滑动到该索引
		if(typeof n == 'number'){
			cidx = idx;
		//如果是传字符则为索引的变化
		}else if(typeof n == 'string'){
			cidx = idx + n*1;
		}
		//当索引右超出
		if(cidx > len-1){
			cidx = len - 1;
		//当索引左超出	
		}else if(cidx < 0){
			cidx = 0;
		}

		//保留当前索引值
		this.idx = cidx;

		//改变过渡的方式，从无动画变为有动画
		lis[cidx].style.webkitTransition = '-webkit-transform 0.2s ease-out';
		lis[cidx-1] && (lis[cidx-1].style.webkitTransition = '-webkit-transform 0.2s ease-out');
		lis[cidx+1] && (lis[cidx+1].style.webkitTransition = '-webkit-transform 0.2s ease-out');

		//改变动画后所应该的位移值
		lis[cidx].style.webkitTransform = 'translate3d(0, 0, 0)';
		lis[cidx-1] && (lis[cidx-1].style.webkitTransform = 'translate3d(-'+ this.scaleW +'px, 0, 0)');
		lis[cidx+1] && (lis[cidx+1].style.webkitTransform = 'translate3d('+ this.scaleW +'px, 0, 0)');
	};

	//第三步 -- 绑定 DOM 事件
	Slider.prototype.bindDOM = function(){
		var self = this;
		var scaleW = self.scaleW;
		var outer = self.outer;
		var len = self.list.length;

		//手指按下的处理事件
		var startHandler = function(evt){

			//记录刚刚开始按下的时间
			self.startTime = new Date() * 1;

			//记录手指按下的坐标
			self.startX = evt.touches[0].pageX;

			//清除偏移量
			self.offsetX = 0;

			//事件对象
			var target = evt.target;
			while(target.nodeName != 'LI' && target.nodeName != 'BODY'){
				target = target.parentNode;
			}
			self.target = target;

		};

		//手指移动的处理事件
		var moveHandler = function(evt){
			//兼容chrome android，阻止浏览器默认行为
			evt.preventDefault();

			//计算手指的偏移量
			self.offsetX = evt.targetTouches[0].pageX - self.startX;

			var lis = outer.getElementsByTagName('li');
			//起始索引
			var i = self.idx - 1;
			//结束索引
			var m = i + 3;

			//最小化改变DOM属性
			for(i; i < m; i++){
				lis[i] && (lis[i].style.webkitTransition = '-webkit-transform 0s ease-out');
				lis[i] && (lis[i].style.webkitTransform = 'translate3d('+ ((i-self.idx)*self.scaleW + self.offsetX) +'px, 0, 0)');
			}
		};

		//手指抬起的处理事件
		var endHandler = function(evt){
			evt.preventDefault();

			//边界就翻页值
			var boundary = scaleW/6;

			//手指抬起的时间值
			var endTime = new Date() * 1;

			//所有列表项
			var lis = outer.getElementsByTagName('li');

			//当手指移动时间超过300ms 的时候，按位移算
			if(endTime - self.startTime > 300){
				if(self.offsetX >= boundary){
					self.goIndex('-1');
				}else if(self.offsetX < 0 && self.offsetX < -boundary){
					self.goIndex('+1');
				}else{
					self.goIndex('0');
				}
			}else{
				//优化
				//快速移动也能使得翻页
				if(self.offsetX > 50){
					self.goIndex('-1');
				} else if(self.offsetX < -50){
					self.goIndex('+1');
				} else if(self.offsetX == 0){
					outer.parentNode.style.display = 'none';
					outer.parentNode.innerHTML = '';				

				}else{
					self.goIndex('0');
				}
			}


		};

		//绑定事件
		outer.addEventListener('touchstart', startHandler);
		outer.addEventListener('touchmove', moveHandler);
		outer.addEventListener('touchend', endHandler);
	};
	/* 通过URL获取CODE值 */
	function urlFormat(arg){
		// ?content_code=string&share=1
		var url = window.location.search;
		if(typeof url != 'string' || url == '') return;
		var newUrl = url.substr(1);
		var urlArr = newUrl.split('&');
		for(var i=0; i<urlArr.length; i++){
			var arr = urlArr[i].split('=');
			for(j=0; j<arr.length; j++){
				if(arg == arr[0]){
					return arr[1]
				}
			}
		}
	}
		
	</script>
</body>
</html>