<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>详情</title>
<meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
<meta name="format-detection" content="telephone=no">
<meta name="format-detection" content="email=no" >
<meta name="keywords" content="">
<meta name="description" content="">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="author" content="">
<link rel="stylesheet" type="text/css" href="../static/css/base.css">
<style type="text/css">
.container{padding-bottom: 0.8rem;}
/* Header Style */
.user{height: 0.58rem; padding: 0 0.16rem 0 0.22rem; }
.user .head{height: 0.32rem; margin: 0.13rem 0 0; display: -webkit-flex; display: flex; float: left;}
.user .photo{width: 0.32rem; height: 0.32rem; margin-right: 0.1rem; position: relative; border-radius: 50%; float: left;}
.user .photo img{width: 0.32rem; height: 0.32rem; border-radius: 50%;}
.user .mark{width: 0.1rem; height: 0.1rem; background: url(../static/img/icon_markbig.png) left top; background-size: cover; position: absolute; right: 0; bottom: 0;}
.user .qiye{width: 0.1rem; height: 0.1rem; background: url(../static/img/icon_qiyeSmall@3x.png) left top; background-size: cover; position: absolute; right: 0; bottom: 0;}
.user .info{max-width: 2rem; height: 0.32rem; line-height: 0.16rem; overflow: hidden;}
.user .name{max-width: 1.95rem; height: 0.16rem; white-space: nowrap; font-size: 0.13rem; overflow: hidden; line-height: 0.16rem; font-weight: 700; color: #212121;}
.user .name.ct{height: 0.32rem; line-height: 0.32rem;}
.user .title{height: 0.16rem; overflow: hidden; font-size: 0.12rem; color: #757575; white-space: nowrap; text-overflow: ellipsis;}
.user .index{width: 0.7rem; height: 0.26rem; margin: 0.16rem 0 0; border: #F8800A 1px solid; font-size: 0.12rem; display: block; float: right; text-align: center; line-height: 0.27rem; color: #F8800A;}
.read{padding: 0.16rem 0.22rem 0.1rem; height: 0.18rem; line-height: 0.18rem; color: #BDBDBD; font-size: 0.13rem;}
.read .assist .assNum{float: right;   color: #F8800A;}
.read .assist .assNum.like:before{content: ""; width: 0.22rem; height: 0.18rem; float: left; margin-right: 6px; background: url('../static/img/like@2x.png') no-repeat center center; background-size: cover;}
.read .assist .assNum.nolike:before{content: ""; width: 0.22rem; height: 0.18rem; float: left; margin-right: 6px; background: url('../static/img/nolike@2x.png') no-repeat center center; background-size: cover;}
.read .assist .readnum{padding-left: 0.15rem;}
.read .related .assNum{display: none;}
.read .related .readnum{float: right;}
/* Content Style */
.content .title{padding: 0.25rem 0.22rem 0.04rem; line-height: 0.24rem; font-size: 0.2rem; color: #212121; word-wrap: break-word; word-break: break-all;}
.content .video-title{padding: 0.13rem 0.22rem 0.04rem; line-height: 0.24rem; font-size: 0.2rem; color: #212121; font-weight: 700;}
.content .address{margin-top: 0.05rem; padding: 0 0.22rem; font-size: 0.13rem; line-height: 0.18rem; color: #BDBDBD;}
.content .address:after{content: ""; float: left; width: 10px; height: 11px; margin: 0.03rem 0.05rem 0 1px; background: url('../static/img/coordinate@3x.png') no-repeat; background-size: 10px;}
.content .referral{margin: 0.24rem 0.22rem 0; border-bottom: #E6E6E6 solid 1px;}
.content .referral h3{font-size: 0.16rem; line-height: 0.22rem; color: #212121;}
.content .referral p{padding: 0.1rem 0 0.11rem; font-size: 0.15rem; color: #BDBDBD; line-height: 0.22rem; text-indent: 0.30rem; text-align: justify;}
.content .detail{padding: 0 0.22rem; margin-top: 0.1rem; line-height: 0.22rem; word-wrap: break-word; word-break: break-all; font-size: 0.16rem; color: #212121;}
.content .detail p{margin-bottom: 0.1rem; text-align: justify; font-size: 0.15rem;}
.content .detail img{display: block; margin: 0 auto 0.1rem;}
.content .detail p img{margin: 0;}
.content .tag{padding: 0.16rem 0.22rem 0;}
.content .tag li{border: #e6e6e6 1px solid; display: inline-block; border-radius: 4px; margin: 0 0.08rem 0.1rem 0; padding: 0 0.1rem; font-size: 0.14rem; color: #757575; line-height: 0.27rem;}
.content .caption{padding: 0.16rem 0.22rem 0; line-height: 0.27rem; font-size: 0.16rem; color: #535252; text-align: justify; word-break: break-all; word-wrap: break-word;}
.content .cover{text-align: center;}
.content .video{background: #000;}
/* Shop Style */
.shop{padding: 0.13rem 0.22rem 0; border-top: #f8f8f8 0.14rem solid;}
.shop .title{line-height: 0.25rem; font-size: 0.18rem; color: #535252;}
.shop .item{height: 1rem; padding: 0.12rem 0; border-bottom: #F0F0F0 1px solid;}
.shop .item:last-child{border-bottom: 0;}
.shop .list-img{width: 1rem; height: 1rem; margin-right: 0.15rem; float: left; border: #f8f8f8 1px solid; box-sizing: border-box;}
.shop .list-img img{width: 100%; height: 100%;}
.shop .name{color: #343434; line-height: 0.2rem; text-align: justify;}
.shop .price{float: left; padding-top: 0.3rem; color: #FF7E00; font-size: 0.12rem;}
.shop .price em{font-size: 0.2rem; line-height: 0.3rem;}
.shop .btn{width: 0.66rem; height: 0.26rem; margin: 0.33rem 0 0; background: #FF7E00; color: #fff; text-align: center; line-height: 0.26rem; float: right; font-size: 0.12rem;}
.reward .reward-but{width: 0.9rem; height: 0.4rem; margin: 0.4rem auto 0.3rem; display: block; border-radius: 2px; font-size: 0.18rem; background: #F8800A; text-align: center; line-height: 0.4rem; color: #fff;}
.reward .reward-wrap{overflow: auto;}
.reward .reward-num{text-align: center; font: 0.14rem/0.2rem "PingFangSC-Regular"; color: #757575;}
.reward .reward-num em{color: #F8800A;}
.reward .reward-list{padding: 0.15rem 0.16rem 0 0.22rem; overflow: auto;}
.reward .reward-list li{width: 0.36rem; height: 0.36rem; margin: 0 0.06rem 0 0; float: left; overflow: hidden; border-radius: 50%;}
.reward .reward-list li img{width: 0.36rem; height: 0.36rem; border-radius: 50%;}
</style>
</head>
<body>
<section class="container" v-cloak>
	<header class="user">
		<div class="head">
			<div class="photo" @click="headCallback(res.sportingMoment.userBasicInfo.userCode)">
				<img :src="res.sportingMoment.userBasicInfo.aboutHead?res.sportingMoment.userBasicInfo.aboutHead:'../static/img/default_photo.png'" alt="">
				<em class="mark" v-if="res.sportingMoment.userBasicInfo.type == 'dzsd4107100310010002'"></em>
				<em class="qiye" v-if="res.sportingMoment.userBasicInfo.type == 'dzsd4107100310010003'"></em>
			</div>
			<div class="info">
				<h1 class="name" :class="{ct:!res.sportingMoment.userBasicInfo.title}">{{res.sportingMoment.userBasicInfo.nickName}}</h1>
				<h3 class="title" v-if="!!res.sportingMoment.userBasicInfo.title">{{res.sportingMoment.userBasicInfo.title}}</h3>
			</div>
		</div>
		<a href="javascript:;" class="index" @click="headCallback(res.sportingMoment.userBasicInfo.userCode)">Ta的主页</a>
	</header>
	<!-- content -->
	<article class="content">
		<child-detail :res="res" v-if="res.sportingMoment.contentType == 'dzsd4107100110030001'"></child-detail>
		<child-detail :res="res" v-if="res.sportingMoment.contentType == 'dzsd4107100110030002'"></child-detail>
		<child-picture :res="res" v-if="res.sportingMoment.contentType == 'dzsd4107100110030004'"></child-picture>
		<child-video :res="res" v-if="res.sportingMoment.contentType == 'dzsd4107100110030005'"></child-video>
		<child-live :res="res" v-if="res.sportingMoment.contentType == 'dzsd4107100110030008'"></child-video>
	</article>
	<!-- pack -->
	<article class="reward" v-if="res.sportingMoment.redPackFlag == 'dzsd4699100110010001'">
		<button type="button" class="reward-but" @click="callReward(res.sportingMoment.userBasicInfo.aboutHead)">赏</button>
		<div class="reward-wrap" v-if="!share">
			<div class="reward-num"><em>{{res.contentDetailInfo.redPackNum}}</em>人打赏</div>
			<ul class="reward-list" @click="callRewardList()">
				<li v-for="item in res.contentDetailInfo.redPackUsers"><img :src="item.aboutHead" alt=""></li>
			</ul>
		</div>
	</article>
	<!-- end -->
	<article class="read">
		<div :class="[share?'assist':'related']">
			<em class="time">{{res.sportingMoment.publishTimeStr}}</em>
			<em class="readnum">{{res.sportingMoment.readNum}}次浏览</em>
			<span :class="['assNum',res.sportingMoment.favorFlag?'like':'nolike']" @click="callFavor">{{res.sportingMoment.praiseNum}}</span>
		</div>
	</article>
	<!-- shop module -->
	<article class="shop" v-if="shop.productInfos.length">
		<h3 class="title">{{shop.title}}</h3>
		<ul class="list">
			<li class="item clearfix" v-for="item in shop.productInfos" @click="callTaobao(item.iosUrl,item.androidUrl)">
				<div class="list-img">
					<img src="../static/img/lazyload.jpg" v-lazyload:opt.fadein="item.picurl" alt="">
				</div>
				<div class="list-info">
					<h1 class="name">{{item.name}}</h1>
					<span class="price">￥<em>{{item.price}}</em></span>
					<em class="btn">去购买</em>
				</div>
			</li>
		</ul>
	</article>
	<!-- end -->
	<!-- data loading -->
	<aside class="loading" transition="fade" v-if="loading"><em><img src="../static/img/doing.gif">数据加载中...</em></aside>
</section>
<!-- 文章详情 -->
<script type="text/x-template" id="template-detail">
	<div class="cover"><img src="../static/img/lazyload.jpg" v-lazyload:opt.fadein="res.sportingMoment.cover" alt=""></div>
	<h1 class="title">{{{res.sportingMoment.title}}}</h1>
	<h2 class="address" v-if="res.sportingMoment.localtionName">{{res.sportingMoment.localtionName}}</h2>
	<div class="referral" v-if="res.contentDetailInfo.description">
		<h3>推荐语</h3>
		<p>
		{{res.contentDetailInfo.description}}
		</p>
	</div>
	<div class="detail">
		{{{res.contentDetailInfo.content | filterVideo res.contentDetailInfo.videoUrl res.contentDetailInfo.videoCover}}}
	</div>
	<child-tag :res="res"></child-tag>
</script>
<!-- end -->
<!-- 单图详情 -->
<script type="text/x-template" id="template-picture">
	<div class="cover"><img src="../static/img/lazyload.jpg" v-lazyload:opt.fadein="res.sportingMoment.cover" alt=""></div>
	<p class="caption">
		{{{res.contentDetailInfo.content}}}
	</p>
	<h2 class="address" v-if="res.sportingMoment.localtionName">{{res.sportingMoment.localtionName}}</h2>
	<child-tag :res="res"></child-tag>
</script>
<!-- end -->
<!-- 视频详情 -->
<script type="text/x-template" id="template-video">
	<div class="zy_media">
		<video :poster="res.contentDetailInfo.videoCover">
	        <source :src="res.contentDetailInfo.videoUrl" type="video/mp4">
	        您的浏览器不支持HTML5视频
	    </video>
	</div>
	<h1 class="video-title">{{res.sportingMoment.title}}</h1>
	<h2 class="address" v-if="res.sportingMoment.localtionName">{{res.sportingMoment.localtionName}}</h2>
	<child-tag :res="res"></child-tag>
</script>
<!-- end -->
<!-- 标签类型 -->
<script type="text/x-template" id="template-tag">
	<ul class="tag" v-if="res.sportingMoment.tags.length">
		<li v-for="tag in res.sportingMoment.tags" @click="tagCallback(tag.code,tag.name)">{{tag.name}}</li>
	</ul>
</script>
<!-- end -->
<!-- 第三方直播流 -->
<script type="text/x-template" id="template-live">
	<div class="media" id="media"></div>
	<!-- <template v-if="response.detail.status == '0'">
		<div class="end">
			<img :src="response.detail.cover" alt="">
			<div class="end-info">
				<h1>直播已结束</h1>
			</div>
		</div>
	</template> -->
	<h1 class="video-title">{{res.sportingMoment.title}}</h1>
</script>
<!-- end -->
<script type="text/javascript" src="script/common.min.js"></script>
<script type="text/javascript" src="../static/js/tools.js"></script>
<script type="text/javascript" src="../static/js/jweixin-1.0.0.js"></script>
<script type="text/javascript" src="../static/js/live_connect.js"></script>
<script type="text/javascript">
var wechat = navigator.userAgent.indexOf('MicroMessenger') > -1;
if(wechat){
	if(!sessionStorage.getItem('token')){
		$.ajax({
			url:'/api/wechatController/authLogin2',
			type:'POST',
			contentType:'application/json',
			dataType: 'json',
			async: false,
			data:'{"code": "' + queryUrl('code') + '","zoo": {"key": "tesetkey","token": " "}}',
			success:function(res){
				if(res.status == 1){
					sessionStorage.setItem('code',res.userCode);
					sessionStorage.setItem('token',res.userToken);
				}else{
					alert(res.error);
				}
			}
		});
	}
}
Vue.use(Vue.lazyimg,{
	nohori: true
});
Vue.component('child-detail',{
	template:'#template-detail',
	props:{
		res:null
	},
	data:function(){
		return {
			videoWd:window.innerWidth - 44 
		}
	},
	ready:function(){
		if(this.res.sportingMoment.contentType == "dzsd4107100110030002"){
			this.video()
		}
	},
	methods:{
		video:function(){
			var _this = this;
			zymedia('video',{
				alwaysShowControls: true,
				hideVideoControlsOnLoad:true,
				videoWidth: window.innerWidth-44,
				videoHeight: window.innerWidth-44,
				preload:'auto'
			});
		}
	}
});
Vue.component('child-picture',{
	template:'#template-picture',
	props:{
		res:null
	}
});
Vue.component('child-live',{
	template:'#template-live',
	props:{
		res: null
	},
	ready: function(){
		this.live();
	},
	methods:{
		live: function(){
			var _this = this;
			new qcVideo.Player("media",{
				"live_url" : _this.res.contentDetailInfo.videoUrl,
				"live_url2" : _this.res.contentDetailInfo.videoUrl,
				'width' : window.innerWidth,
				'height' : window.innerWidth,
				'x5_fullscreen': true,
				'h5_start_patch': {
					'url': _this.res.sportingMoment.cover,
					'stretch': true
				}
			});
		}
	}
})
Vue.component('child-video',{
	template:'#template-video',
	props:{
		res:null
	},
	data:function(){
		return {
			videoWd:window.innerWidth
		}
	},
	ready:function(){
		this.video();
	},
	methods:{
		video:function(){
			var _this = this;
			zymedia('video',{
				alwaysShowControls: true,
				hideVideoControlsOnLoad:true,
				videoWidth: window.innerWidth,
				videoHeight: window.innerWidth,
				preload:'auto'
			});
		}
	}
});
Vue.component('child-tag',{
	data:function(){
		return {
			share:queryUrl('share')
		}
	},
	props:{
		res: null
	},
	template:'#template-tag',
	methods:{
		tagCallback:function(code,name){
			if(!this.share){
				callbackLabel(code,name)
			}else{
				open()
			}
		}
	}
});
Vue.filter('filterVideo', function (value, url, conver) {
	var ele = '<div class="zy_media">\
				<div class="zy_wrap">\
					<video poster="' + conver + '" preload="auto" style="' + window.innerWidth + '">\
					<source type="video/mp4" src="' + url + '">您的浏览器不支持HTML5视频</video>\
					</div>\
				</div>';
	//var re = /<span style="display: block;"([^<>]*)>([^<>]*)<\/span>/gi;
	var re = /<span style="display: block;"([^<>]*)>([^<>]*)<\/span>|\[godovideobingo\]/gi;
	return value.replace(re,ele);
})
var vm = new Vue({
	el:'.container',
	data:{
		res: null,
		shop: [],
		share: queryUrl('share'),
		loading: true
	},
	created:function(){
		this.reqwest();
		if(this.share){
			share();
		}
	},
	methods:{
		reqwest:function(){
			var _this = this;
			var token = sessionStorage.getItem('token')?sessionStorage.getItem('token'):'';
			reqwest({
				url: '/api/contentController/contentDetail',
				method: 'post',
				data: '{"content_code": "' + queryUrl('id') + '", "width": "' + window.innerWidth + '","zoo": {"key": "tesetkey","token": "' + token + '"}}',
				type: 'json',
				contentType: 'application/json',
				success: function(resp) {
					if(resp.status == 1){
						_this.res = resp;
						//_this.loading = false;
						setTimeout(function(){
							_this.loading = false;
						}, 1700);
					}else{
						_this.loading = false;
						alert('数据请求失败');
						_this.fineshPage();
					}
				}
			});
			reqwest({
				url: '/api/userController/shareContent',
				method: 'post',
				data: '{"contentCode": "' + queryUrl('id') + '","zoo": {"key": "tesetkey","token": " "}}',
				type: 'json',
				contentType: 'application/json',
				success: function(resp) {
					if(resp.status == 1){
						shareWeiXin({
							'url':'/api/wechatController/configInfo',
							'imgUrl':resp.iconUrl,
							'title':resp.title,
							'link':'http://api-001.sport.bigtiyu.com/webjars/sportstatic/content_detail.html?share=1&code=' + queryUrl('id'),
							'desc':resp.content
						});
					}
				}
			});
			reqwest({
				url: '/api/contentController/contentDetailProducts',
				method: 'post',
				data: '{"code": "' + queryUrl('id') + '","zoo": {"key": "tesetkey","token": " "}}',
				type: 'json',
				contentType: 'application/json',
				success: function(resp) {
					if(resp.status == 1){
						_this.shop = resp;
					}
				}
			});
			reqwest({
				url: '/api/contentController/contentReadCount',
				method: 'post',
				data: '{"code": "' + queryUrl('id') + '","zoo": {"key": "tesetkey","token": " "}}',
				type: 'json',
				contentType: 'application/json',
				success: function(resp) {}
			});
		},
		headCallback:function(code){
			var _this = this;
			if(!_this.share){
				callbackFunc(code);
			}else{
				open()
			}
		},
		fineshPage:function(){
			var _this = this;
			if(!_this.share){
				callFineshPage();
			}
		},
		callTaobao:function(ios,and){
			var _this = this;
			if(!_this.share){
				callbackTaobao(ios,and);
			} else {
				window.location.href = ios;
			}
		},
		callReward:function(head){
			var _this = this;
			if(!_this.share){
				callbackReward(head);
			}else{
				open();
			}
		},
		callRewardList:function(){
			var _this = this;
			if(!_this.share){
				callRewardList();
			}
		},
		callFavor:function(){
			var _this = this;
			if(wechat){
				if(!_this.res.sportingMoment.favorFlag){
					this.res.sportingMoment.favorFlag = !this.res.sportingMoment.favorFlag;
					var token = sessionStorage.getItem('token')?sessionStorage.getItem('token'):'';
					reqwest({
						url: '/api/contentController/supportPraise',
						method: 'post',
						data: '{"contentCode": "' + queryUrl('id') + '","isLike": "1","type": "01","zoo": {"key": "tesetkey","token": "' + token + '"}}',
						type: 'json',
						contentType: 'application/json',
						success: function(resp) {
							_this.res.sportingMoment.praiseNum = _this.res.sportingMoment.praiseNum+1;
						}
					});
				}
			} else {
				open();
			}
			
		}
	}
});
</script>
<script type="text/javascript">var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");document.write(unescape("%3Cspan id='cnzz_stat_icon_1260476594'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s95.cnzz.com/z_stat.php%3Fid%3D1260476594' type='text/javascript'%3E%3C/script%3E"));</script>
</body>
</html>