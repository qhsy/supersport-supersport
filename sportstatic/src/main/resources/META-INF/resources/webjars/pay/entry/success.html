<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>订单支付</title>
<meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
<meta name="format-detection" content="telephone=no,email=no"> 
<meta name="keywords" content="">
<meta name="description" content="">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-touch-fullscreen" content="yes"> 
<meta name="App-Config" content="fullscreen=yes,useHistoryState=yes,transition=yes"/>
<meta name="author" content="">
<link rel="stylesheet" type="text/css" href="../../static/css/base.css">
<style type="text/css">
body{background: #f8f8f8;}
.order li{padding: 0.22rem 0.24rem 0.16rem; box-shadow: 0 2px 3px rgba(0,0,0,0.12); background: #fff; color: #BDBDBD;}
.order .title{font-size: 0.24rem; color: #656570; line-height: 0.24rem; word-wrap: break-word; word-break: break-all;}
.order .price, .order .number{height: 0.22rem; text-align: right; font-size: 0.18rem; color: #BDBDBD; line-height: 0.22rem;}
.order .price{margin: 0.45rem 0 0.15rem;}
.order .price em{padding-right: 5px; font-size: 12px;}
.order .price i{font-size: 0.22rem;}
.order .price span, .order .number span{float: left;}
.order .result{padding-top: 0.3rem;}
.order .result span{height: 0.37rem; width: 0.37rem; display: block; margin: auto; background: url('../../static/img/end@2x.png') no-repeat center center; background-size: cover;}
.order .result h1{padding: 0.12rem 0 0.19rem; text-align: center; font-size: 0.18rem; color: #F8800A; font-weight: 700; line-height: 0.22rem;}
.submit, .back{width: 100%; height: 0.55rem; background: #F8800A; position: fixed; left: 0; bottom: 0; font-weight: 700; text-align: center; color: #fff; line-height: 0.55rem; font-size: 0.18rem;}
.submit.no{background: #cdcbcb;}
</style>
</head>
<body>
<section class="container">
	<ul class="order">
		<li>
			<h1 class="title">体育大讲堂</h1>
			<template v-if="!sucStatus">
				<div class="info">
					<div class="price"><span>应付款</span><em>￥</em><i>288</i></div>
					<div class="number"><span>订单号</span>41223512515</div>
				</div>
			</template>
			<template v-else>
				<div class="result">
					<span></span>
					<h1>报名支付成功</h1>
				</div>
			</template>
		</li>
	</ul>
	<template v-if="!sucStatus">
		<template v-if="payStatus">
			<button type="button" class="submit" @click="payOrder">去支付</button>
		</template>
		<template v-else>
			<button type="button" class="submit no" @click="payOrder">支付中</button>
		</template>
	</template>
	<template v-else>
		<a href="javascript:;" class="back">下载果冻APP</a>	
	</template>
	
</section>
<script type="text/javascript" src="../../sportstatic/script/common.min.js"></script>
<script type="text/javascript" src="../../static/js/jweixin-1.0.0.js"></script>
<script type="text/javascript" src="../../static/js/wxConfig.js"></script>
<script>
wxConfigFun();
new Vue({
	el:'.container',
	data:{
		payStatus: true,
		sucStatus: false
	},
	created:function(){

	},
	methods:{
		apiGetData:function(){
			reqwest({
				url: '',
				method: 'post',
				data: '',
				type: 'json',
				contentType: 'application/json',
				success: function(resp) {
					if(resp.status == 1){
						
					}else{
						
					}
				}
			});
		},
		payOrder:function(){
			var _this = this;
			if(_this.payStatus){
				_this.payStatus = false;
				reqwest({
					url: '/api/payController/wechatH5Pay',
					method: 'post',
					data: '{"orderCode": "string","payMoney": 0,"romoteIP": "","serveIP": "","zoo": {"key": "tesetkey","token": " "}}',
					type: 'json',
					contentType: 'application/json',
					success: function(resp) {
						if(resp.status == 1){
							if (typeof WeixinJSBridge == "undefined") {
								if (document.addEventListener) {
									document.addEventListener('WeixinJSBridgeReady', function(){
										bridge(resp.wechatH5PayResponse)
									}, false);
								} else if (document.attachEvent) {
									document.attachEvent('WeixinJSBridgeReady', function(){
										bridge(resp.wechatH5PayResponse)
									});
									document.attachEvent('onWeixinJSBridgeReady', function(){
										bridge(resp.wechatH5PayResponse)
									});
								}
							} else {
								bridge(resp.wechatH5PayResponse);
							}
						}else{
							_this.payStatus = true;
							alert(resp.error)
						}
					}
				});
			}
		},
		bridge:function(response){
			var _this = this;
	    	WeixinJSBridge.invoke('getBrandWCPayRequest', {
				"appId":response.appId,
				"timeStamp":response.timeStamp,
				"nonceStr":response.nonceStr,
				"package":"prepay_id=" + response.prepay_id,
				"signType":response.signType,
				"paySign":response.paySign
			}, function(result) {
				if (result.err_msg == "get_brand_wcpay_request:ok") {
					_this.sucStatus = true;
				}else{
					_this.payStatus = true;
					alert('支付失败，请重新支付！');
				}
			});
	    }
	}
});
</script>
</body>
</html>