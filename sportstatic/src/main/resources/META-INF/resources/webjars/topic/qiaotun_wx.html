<!DOCTYPE html>
<html lang="en" id="qiaotun">
<head>
<meta charset="UTF-8">
<title>为翘而生·2016微赛&果冻体育美臀小姐选美大赛</title>
<meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
<meta name="format-detection" content="telephone=no">
<meta name="format-detection" content="email=no" >
<meta name="keywords" content="为翘而生·2016微赛&果冻体育美臀小姐选美大赛">
<meta name="description" content="为翘而生·2016微赛&果冻体育美臀小姐选美大赛">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="author" content="果冻体育">
<link rel="stylesheet" href="css/base.css">
<style type="text/css">
.header{overflow: auto; margin-top: 0.6rem; background: url(img/qiaotun_head.jpg) no-repeat center top; background-size: cover;}
.header .title{width: 2.35rem; height: 0.89rem; margin: 0.45rem auto 0;}
.header .logo{width: 1.38rem; height: 0.23rem; margin: auto;}
.header .text{padding: 0 0.35rem 0.4rem; margin: 0.47rem auto 0; color: #F6F6F6; font-size: 0.12rem; line-height: 0.18rem; text-align: justify;}
.header .help a{padding: 0 0.35rem; height: 0.14rem; color: #F8800A; font-size: 0.12rem;}
.header .help a img{width: 0.14rem; vertical-align: middle;}
.header .button{height: 0.38rem; margin: 0.12rem 0 0.1rem; text-align: center;}
.header .button a{width: 1.21rem; height: 0.38rem; display: inline-block; padding: 0 0.19rem; text-align: center; line-height: 0.38rem; color: #fff;}

/* container */
.tab-nav{margin: 0.05rem 0 0.12rem; border-bottom: #352553 1px solid; text-align: center;}
.tab-nav a{padding: 0 2px 0 0.27rem; display: inline-block; color: #fff; line-height: 0.34rem;}
.tab-nav a:nth-child(1){margin-right: 0.57rem; background: url(img/qiaotun_1_1.png) no-repeat left center; background-size: 0.19rem;}
.tab-nav a:nth-child(1).curr{color: #F8800A!important; border-bottom: #F8800A 1px solid; background: url(img/qiaotun_1_2.png) no-repeat left center; background-size: 0.19rem;}
.tab-nav a:nth-child(2){margin-left: 0.57rem; background: url(img/qiaotun_2_1.png) no-repeat left center; background-size: 0.19rem;}
.tab-nav a:nth-child(2).curr{color: #F8800A!important; border-bottom: #F8800A 1px solid; background: url(img/qiaotun_2_2.png) no-repeat left center; background-size: 0.19rem;}

.list-item{margin-bottom: 0.1rem; position: relative;}
.list-item .canvas img {transition: opacity 0.2s !important;}
.list-item .info{width: 100%; box-sizing: border-box; padding: 0.54rem 0.19rem 0.16rem; color: #fff; line-height: 0.42rem; z-index: 9; position: absolute; bottom: 0;  background: -webkit-linear-gradient(rgba(0,0,0,0), rgba(0,0,0,0.5));  background: linear-gradient(rgba(0,0,0,0), rgba(0,0,0,0.5));}
.list-item .photo{display: inline-block; vertical-align: top; width: 0.38rem; height: 0.38rem; border-radius: 50%; border: 2px solid #fff; position: relative;}
.list-item .photo img{border-radius: 50%;}
.list-item .name{padding-left: 0.09rem;}
.list-item .zan{height: 0.42rem; float: right;}
.list-item .zanEvent{height: 0.42rem; float: right; font-family: "Helvetica"; position: relative;}
.list-item .zanEvent i{color: red; position: absolute; left: 2px; top: 0; opacity: 0; transition: all .2s; display: none; -webkit-animation:calculation 1s; font-size: 0.16rem;}
.list-item .zanEvent:after{content:""; width: 0.21rem; height: 0.17rem; margin: 0.12rem 0.1rem 0 0; background: url(img/like.png) no-repeat left top; float: left; background-size: 0.21rem;}
.list-item .zanEvent.curr:after{content:""; width: 0.21rem; height: 0.17rem; margin: 0.12rem 0.1rem 0 0; background: url(img/like.png) no-repeat left bottom; float: left; background-size: 0.21rem;}
.list-item .sign{width: 0.14rem; height: 0.12rem; display: block; position: absolute; right: 0; bottom: 0; background: url(img/sign.png) no-repeat; background-size: cover;}
@media screen and (min-width:640px){
	.header, .wrap{width: 640px; margin: auto;}
}
@media screen and (max-width:320px){
	html{font-size: 85.5px;}
}
@-webkit-keyframes load{
    0%{-webkit-transform: rotate(0deg);}
    100%{-webkit-transform: rotate(360deg);}
}
@keyframes load{
    0%{transform: rotate(0deg);}
    100%{transform: rotate(360deg);}
}
@-webkit-keyframes calculation{
    0%{opacity: 0; top: 0;}
    100%{opacity: 1; top: -20px;}
}
@keyframes calculation{
    0%{opacity: 0; top: 0;}
    100%{opacity: 1; top: -20px;}
}
</style>
</head>
<body>
<header class="open-app">
	<span class="app-logo"><img src="img/about.png"></span>
	<a href="javascript:;" class="app-btn" @click="open">打开App</a>
</header>
<header class="header" v-cloak>
	<h1 class="title"><img src="img/qiaotun_title.png" alt=""></h1>
	<div class="logo"><img src="img/qiaotun_logo.png" alt=""></div>
	<p class="text">
	{{viewer.notes}}
	</p>
	<!-- <p class="help"><a href="http://mp.weixin.qq.com/s?__biz=MzAwNzk2MjI1OA==&mid=100000235&idx=1&sn=6e4d8a230e9d780191cc7007e0a5a906&scene=20#wechat_redirect"><img src="img/qiaotun_icon.png" alt="">点击这里查看晒图方式</a></p>
	<div class="button">
		<a :href="viewer.applyUrl"><img src="img/qiaotun_tab_2.png" alt=""></a></a>
	</div> -->
</header>
<section class="wrap" v-cloak>
	<article class="container">
		<nav class="tab-nav">
			<a href="javascript:;" class="curr" v-bind:class="{curr:currStatus == 'power'}" @click="tab(0)">实力派</a>
			<a href="javascript:;" v-bind:class="{curr:currStatus == 'lap'}" @click="tab(1)">翘丽圈</a>
		</nav>
		<ul class="data-list">
			<template v-if="viewer.buttockInfos[0].contentInfos.length">
			<li class="list-item" v-for="item in viewer.buttockInfos[0].contentInfos">
				<template v-if="item.contentType == 'dzsd4107100110030003'">
					<a href="../sportstatic/photo.html?code={{item.code}}&share=1" >
						<div class="canvas"><img src="img/lazyload.jpg" v-lazyload:opt.fadein="item.cover" alt=""></div>
					</a>
					<div class="info">
						<span class="photo"><img :src="item.userBasicInfo.aboutHead" alt=""><i class="sign" v-if="item.userBasicInfo.type == 'dzsd4107100310010002'"></i></span>
						<em class="name">{{item.userBasicInfo.nickName}}</em>
						<span class="zanEvent" :data-code="item.code" :data-num="item.praiseNum" v-if="currStatus == 'power'" :class="{curr:item.favorFlag}"><em>{{item.praiseNum}}</em><i>+1</i></span>
						<em class="zan" v-else>喜欢 {{item.praiseNum}}</em>
					</div>
				</template>
				<template v-else>
					<a href="../sportstatic/default.html?code={{item.code}}&share=1">
						<div class="canvas"><img src="img/lazyload.jpg" v-lazyload:opt.fadein="item.cover" alt=""></div>
					</a>
					<div class="info">
						<span class="photo"><img :src="item.userBasicInfo.aboutHead" alt=""><i class="sign" v-if="item.userBasicInfo.type == 'dzsd4107100310010002'"></i></span>
						<em class="name">{{item.userBasicInfo.nickName}}</em>
						<span class="zanEvent" :data-code="item.code" :data-num="item.praiseNum" v-if="currStatus == 'power'" :class="{curr:item.favorFlag}"><en>{{item.praiseNum}}</en><i>+1</i></span>
						<em class="zan" v-else>喜欢 {{item.praiseNum}}</em>
					</div>
				</template>
			</li>
			</template>
		</ul>
		<div class="load" v-if="load">
			<em></em>数据加载中...
		</div>
	</article>
</section>
<script type="text/javascript" src="js/zepto.min.js"></script>
<script type="text/javascript" src="js/vue.min.js"></script>
<script type="text/javascript" src="js/vue.lazyimg.js"></script>
<script type="text/javascript" src="../common/share.js"></script>
<script type="text/javascript" src="../common/lib/jweixin-1.0.0.js"></script>
<script>
var isWeix = navigator.userAgent.indexOf('MicroMessenger') > -1;
var share = {
	title:'为翘而生•2016微赛&果冻体育美臀小姐选美大赛',
	link:'http://api-001.sport.bigtiyu.com/webjars/topic/qiaotun_share.html',
	imgUrl:'http://api-001.sport.bigtiyu.com/webjars/topic/img/qiaotun_share.jpg',
	desc:'快来为你喜爱的选手投票吧！果冻美臀宝贝由你来决定！'

}
if(isWeix && !sessionStorage.getItem('code')){
	var wxCode = paramFn('code');
	$.ajax({
		url:'/api/wechatController/authLogin2',
		type:'POST',
		contentType:'application/json',
		dataType:'json',
		async:false,
		data:'{"code": "' + wxCode + '","zoo": {"key": "tesetkey","token": " "}}',
		success:function(res){
			if(res.status == 1){
				sessionStorage.setItem('code',res.userCode);
				sessionStorage.setItem('token',res.userToken);
			}else{
				alert(res.error);
			}
		}
	});
}
if(isWeix){
	$.ajax({
		url:'/api/wechatController/configInfo',
		type:'POST',
		contentType:'application/json',
		dataType:'json',
		data:'{"url": "' + window.location.href + '","zoo": {"key": "tesetkey", "token": "' + sessionStorage.getItem('token') + '"}}',
		success:function(res){
			if(res.status == 1){
				return wx.config({    
					debug: false,
					appId: res.appId,
					timestamp: res.timestamp,
					nonceStr: res.nonceStr,
					signature: res.signature,
					jsApiList: ['checkJsApi','onMenuShareTimeline','onMenuShareAppMessage','onMenuShareQQ','onMenuShareWeibo','onMenuShareQZone']
				});
			}
		}
	});

	wx.ready(function(){
		//分享到朋友圈
		wx.onMenuShareTimeline({
		    title: share.title,
		    link: share.link, 
		    imgUrl: share.imgUrl,
		    success: function () {},
		    cancel: function () {}
		});
		//分享给朋友
		wx.onMenuShareAppMessage({
		    title: share.title,
		    desc: share.desc,
		    link: share.link,
		    imgUrl: share.imgUrl,
		    type: '',
		    dataUrl: '',
		    success: function () {},
		    cancel: function () {}
		});
		//分享到QQ
		wx.onMenuShareQQ({
		    title: share.title,
		    desc: share.desc,
		    link: share.link,
		    imgUrl: share.imgUrl,
		    success: function () {},
		    cancel: function () {}
		});
		//分享到腾讯微博
		wx.onMenuShareWeibo({
		    title: share.title,
		    desc: share.desc,
		    link: share.link,
		    imgUrl: share.imgUrl,
		    success: function () {},
		    cancel: function () {}
		});
		//分享到QQ空间
		wx.onMenuShareQZone({
		    title:  share.title,
		    desc: share.desc,
		    link: share.link,
		    imgUrl: share.imgUrl,
		    success: function () { },
		    cancel: function () {}
		});
	});
}
Vue.use(Vue.lazyimg,{
    fade: true,
    nohori: false,
    speed: 20,
});
var vm = new Vue({
	el:'#qiaotun',
	data:{
		branches: ['power','lap'],
		currStatus: 'power',
		powerPage: 1,
		lapPage: 1,
		bLoad: true,
		load:true,
		viewer: null
	},
	created:function(){
		this.fetchData();
	},
	watch:{
		currStatus:'fetchData'
	},
	methods:{
		fetchData:function(){
			var self = this;
			$.ajax({
				url:'/api/buttock/buttockInfo',
				type:'POST',
				data:'{"pagination":' + self.powerPage + ',"type": "' + self.currStatus+ '","width":375,"zoo":{"key":"tesetkey","token": "' + token() + '"}}',
				contentType:'application/json',
				dataType:'json',
				success:function(result){
					if(result.status == 1) {
						self.viewer = result;
						self.bLoad = result.buttockInfos[0].nextflag;
						self.load = false;
					}
				}
			});
		},
		tab:function(index){
			var self = this;
			self.viewer = null;
			self.load = true;
			self.currStatus = self.branches[index];
		},
		open:function(){
			open();
		}

	}
});
vm.$on('iscroll',function(){
	var self = this;
	var data = self.viewer;
	$(window).on('scroll',function(){
		var iHeight = $('body').height() + 70;
		var winHeight = $(window).height();
		var scrollHeight = $(window).scrollTop();
		if(iHeight ==  (winHeight + scrollHeight)){
			if(self.bLoad){
				self.bLoad = false;
				var page = self.currStatus == 'power'?(++self.powerPage):(++self.lapPage);
				$.ajax({
					url:'/api/buttock/buttockInfo',
					type:'POST',
					data:'{"pagination":' + page + ',"type": "' + self.currStatus+ '","width":0,"zoo":{"key":"tesetkey","token": "' + token() + '"}}',
					contentType:'application/json',
					dataType:'json',
					before:function(){
						self.load = true;
					},
					success:function(result){
						self.load = false;
						if(result.status == 1){
							if(result.buttockInfos[0].contentInfos.length){
								$.each(result.buttockInfos[0].contentInfos,function(index, item){
									self.viewer.buttockInfos[0].contentInfos.push(item);
								});
								self.bLoad = result.buttockInfos[0].nextflag;
							}
						}else{
							alert(result.error);
						}
					}
				});
			} else {
				if(!$('.tost').length){
					var ele = $('<div class="tost">没有更多数据了</div>');
					ele.appendTo('body');
					setTimeout(function(){
						$('.tost').remove();
					}, 800)
				}
			}
		}
		
	});
})
vm.$emit('iscroll');
function onTopicCategories(author,aboutHead,contentCode,contenttype){
	javascript:android.onTopicCategories(author,aboutHead,contentCode,contenttype);
}
function onBlueprint(){
	javascript:android.onBlueprint()
}
function token(){
	if(sessionStorage.getItem('token')){
		return sessionStorage.getItem('token');
	}else{
		return '';
	}
}
function paramFn (arg){
		var url = window.location.search;
		if(typeof url != 'string' || url == '') return;
		var newUrl = url.substr(1);
		var urlArr = newUrl.split('&');
		for(var i=0; i<urlArr.length; i++){
			var arr = urlArr[i].split('=');
			for(j=0; j<arr.length; j++){
				if(arg == arr[0]){
					return arr[1]
				}
			}
		}
	}
$('.wrap').on('click','.zanEvent',function(){
	var isFavor = $(this).hasClass('curr');
	var num = parseInt($(this).attr('data-num'));
	var code = $(this).attr('data-code');
	var isWeix = navigator.userAgent.indexOf('MicroMessenger') > -1;
	if(!isFavor && isWeix){
		$(this).find('em').text(num+1);
		$(this).addClass('curr');
		$(this).find('i').css('display','block');
		$.ajax({
			url:'/api/contentController/supportPraise',
			type:'POST',
			data:'{"contentCode": "' + code + '","isLike": "1","type": "01","zoo": {"key": "tesetkey","token": "' + sessionStorage.getItem('token') + '"}}',
			contentType:'application/json',
			dataType:'json',
			success:function(result){
				if(result.status == 1) {

				}else{
					alert(result.error)
				}
			}
		});
	}
});
</script>
</body>
</html>