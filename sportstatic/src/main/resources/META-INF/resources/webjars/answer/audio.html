<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>回答</title>
<meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
<meta name="format-detection" content="telephone=no">
<meta name="format-detection" content="email=no" >
<meta name="keywords" content="">
<meta name="description" content="">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="author" content="">
<link rel="stylesheet" href="style/style.css">
</head>
<body>
<section class="wrap">
	<article class="audio">
		<div class="user">
			<span class="photo"><img src="images/demo_2.jpg" alt=""></span>
			<em class="name">壁咚的天气</em>
			<i class="price">￥198</i>
		</div>
		<h1 class="title">为什么认为体育可以改变人生对于普通人也是这样的吗？</h1>
		<div class="status">
			<em>还有48小时过期</em>
			<span class="refused">拒绝回答</span>
		</div>
	</article>
	<article class="sound">
		<h1 class="text">这是一个私密问题，回答也是私密的</h1>
		<div class="status">
			<i class="time"></i>
			<span class="init"></span>
			<em class="reset">重录</em>
		</div>
		<p class="notes">点击开始录音，最多可录制60”</p>
		<div class="status">
			<i class="time">60”</i>
			<span class="load"></span>
			<em class="reset">重录</em>
		</div>
		<p class="notes">录制中，再次点击停止录制</p>
		<div class="status">
			<i class="time">60”</i>
			<span class="play"><i class="iconfont">&#xe603;</i></span>
			<em class="reset curr">重录</em>
		</div>
		<p class="notes">播放试听</p>
		<div class="status">
			<i class="time">60”</i>
			<span class="stop"></span>
			<em class="reset curr">重录</em>
		</div>
		<p class="notes">播放试听</p>
		<a href="javascript:;" class="submit curr">确定发送</a>
	</article>
</section>
<script type="text/javascript" src="js/zepto.min.js"></script>
<script type="text/javascript" src="js/vue.min.js"></script>
<script type="text/javascript" src="js/jweixin-1.0.0.js"></script>
<script>
	var appId,timestamp,nonceStr,signature;
	$.ajax({
		url:'/api/wechatController/configInfo',
		type:'POST',
		contentType:'application/json',
		dataType:'json',
		ansy:false,
		data:'{"url": "' + window.location.href + '","zoo": {"key": "tesetkey", "token": " "}}',
		success:function(res){
			if(res.stauts == '1'){
				appId = res.appId;
				timestamp = res.timestamp;
				nonceStr = res.nonceStr;
				signature = res.signature;
			}
		}
	});
	wx.config({    
		debug: false,
		appId: appId,
		timestamp: timestamp,
		nonceStr: nonceStr,
		signature: signature,
		jsApiList: ['checkJsApi','startRecord','stopRecord','onVoiceRecordEnd','playVoice','pauseVoice','stopVoice','onVoicePlayEnd','uploadVoice','downloadVoice']
		});
	wx.ready(function () {
		var voice = {
			localId: '',
			serverId: ''
		};
		wx.checkJsApi({
			jsApiList: ['checkJsApi','startRecord','stopRecord','onVoiceRecordEnd','playVoice','pauseVoice','stopVoice','onVoicePlayEnd','uploadVoice','downloadVoice'],
			success: function (res) {
				console.log(JSON.stringify(res));
			}
		});

		document.querySelector('.init').onclick = function() {
			wx.startRecord({
				cancel: function () {
					alert('用户拒绝授权录音');
				}
			});
		};
		// 4.3 停止录音
		document.querySelector('.load').onclick = function() {
		    wx.stopRecord({
		        success: function(res) {
		            voice.localId = res.localId;
		        },
		        fail: function(res) {
		            alert(JSON.stringify(res));
		        }
		    });
		};
		// 4.4 监听录音自动停止
		wx.onVoiceRecordEnd({
		    complete: function(res) {
		        voice.localId = res.localId;
		        alert('录音时间已超过一分钟');
		    }
		});
		// 4.5 播放音频
		document.querySelector('.play').onclick = function() {
		    if (voice.localId == '') {
		        alert('请先使用 startRecord 接口录制一段声音');
		        return;
		    }
		    wx.playVoice({
		        localId: voice.localId
		    });
		};
		// 4.6 暂停播放音频
		document.querySelector('.stop').onclick = function() {
		    wx.pauseVoice({
		        localId: voice.localId
		    });
		};
		// 4.7 停止播放音频
		// document.querySelector('#stopVoice').onclick = function() {
		//     wx.stopVoice({
		//         localId: voice.localId
		//     });
		// };
		// 4.8 监听录音播放停止
		wx.onVoicePlayEnd({
		    complete: function(res) {
		        alert('录音（' + res.localId + '）播放结束');
		    }
		});
		// 4.8 上传语音
		// document.querySelector('#uploadVoice').onclick = function() {
		//     if (voice.localId == '') {
		//         alert('请先使用 startRecord 接口录制一段声音');
		//         return;
		//     }
		//     wx.uploadVoice({
		//         localId: voice.localId,
		//         success: function(res) {
		//             alert('上传语音成功，serverId 为' + res.serverId);
		//             voice.serverId = res.serverId;
		//         }
		//     });
		// };
		// 4.9 下载语音
		// document.querySelector('#downloadVoice').onclick = function() {
		//     if (voice.serverId == '') {
		//         alert('请先使用 uploadVoice 上传声音');
		//         return;
		//     }
		//     wx.downloadVoice({
		//         serverId: voice.serverId,
		//         success: function(res) {
		//             alert('下载语音成功，localId 为' + res.localId);
		//             voice.localId = res.localId;
		//         }
		//     });
		// };
	});
</script>
</body>
</html>